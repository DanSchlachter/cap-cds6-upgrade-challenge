# Order Service - Orders with Draft Support
# Test file for OrderService endpoints

### Variables
@host = http://localhost:4004
@orderPath = {{host}}/orders

################################################################################
# Orders (with Draft Support)
################################################################################

### Get all Orders
GET {{orderPath}}/Orders HTTP/1.1

### Get a specific Order
GET {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000) HTTP/1.1

### Get Orders with Items (expand)
GET {{orderPath}}/Orders?$expand=items HTTP/1.1

### Filter Orders by status
GET {{orderPath}}/Orders?$filter=status eq 'open' HTTP/1.1

### Filter Orders by total amount
GET {{orderPath}}/Orders?$filter=totalAmount gt 100 HTTP/1.1

### Get Orders with date range
GET {{orderPath}}/Orders?$filter=orderDate ge 2024-01-01 HTTP/1.1

### Order by date
GET {{orderPath}}/Orders?$orderby=orderDate desc HTTP/1.1

################################################################################
# Draft Operations (Lean Draft)
################################################################################

### Create a new Order (Draft)
POST {{orderPath}}/Orders HTTP/1.1
Content-Type: application/json

{
  "customerName": "John Doe",
  "status": "open"
}

### Create Draft Order with Items
POST {{orderPath}}/Orders HTTP/1.1
Content-Type: application/json

{
  "customerName": "Jane Smith",
  "status": "open",
  "items": [
    {
      "product": "Laptop",
      "quantity": 1,
      "price": 999.99
    },
    {
      "product": "Mouse",
      "quantity": 2,
      "price": 25.50
    }
  ]
}

### Edit Draft Order
PATCH {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000) HTTP/1.1
Content-Type: application/json

{
  "customerName": "Updated Customer Name",
  "status": "confirmed"
}

### Activate Draft (if using draft)
# Note: Draft patterns changed in CDS 7 (Lean Draft)
POST {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000)/draftActivate HTTP/1.1
Content-Type: application/json

{}

### Prepare Draft
POST {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000)/draftPrepare HTTP/1.1
Content-Type: application/json

{}

### Delete Draft Order
DELETE {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000) HTTP/1.1

################################################################################
# Order Items
################################################################################

### Get all Order Items
GET {{orderPath}}/OrderItems HTTP/1.1

### Get Items for a specific Order
GET {{orderPath}}/OrderItems?$filter=order_ID eq 550e8400-e29b-41d4-a716-446655440000 HTTP/1.1

### Get Order Items with Order info (expand)
GET {{orderPath}}/OrderItems?$expand=order HTTP/1.1

### Create a new Order Item
POST {{orderPath}}/OrderItems HTTP/1.1
Content-Type: application/json

{
  "order_ID": "550e8400-e29b-41d4-a716-446655440000",
  "product": "Keyboard",
  "quantity": 1,
  "price": 79.99
}

### Update Order Item quantity
PATCH {{orderPath}}/OrderItems(660e8400-e29b-41d4-a716-446655440001) HTTP/1.1
Content-Type: application/json

{
  "quantity": 3
}

### Delete Order Item
DELETE {{orderPath}}/OrderItems(660e8400-e29b-41d4-a716-446655440001) HTTP/1.1

################################################################################
# Order History (Temporal Data)
################################################################################

### Get Order History
GET {{orderPath}}/OrderHistory HTTP/1.1

### Get History for specific Order
GET {{orderPath}}/OrderHistory?$filter=order_ID eq 550e8400-e29b-41d4-a716-446655440000 HTTP/1.1

### Order History by date (temporal query)
GET {{orderPath}}/OrderHistory?$orderby=changedAt desc HTTP/1.1

### Get History with valid date range
# Note: $at.from/$at.to deprecated in CDS 9 (use $valid.from/$valid.to)
GET {{orderPath}}/OrderHistory?$filter=validFrom le 2024-01-01 and validTo ge 2024-12-31 HTTP/1.1

################################################################################
# Custom Actions/Functions
################################################################################

### Calculate Order Total (custom function)
GET {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000)/calculateTotal() HTTP/1.1

### Ship Order (custom action)
POST {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000)/ship HTTP/1.1
Content-Type: application/json

{
  "trackingNumber": "TRACK123456"
}

### Cancel Order (custom action)
POST {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000)/cancel HTTP/1.1
Content-Type: application/json

{
  "reason": "Customer request"
}

################################################################################
# Test Deprecated APIs (will fail in CDS 8/9)
################################################################################

### Test req.params structure (changed in CDS 9)
# This will test the handler that uses req.params[0]
GET {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000)/items HTTP/1.1

### Test srv.impl() usage (removed in CDS 8)
# Any request to OrderService will trigger handler registration
GET {{orderPath}}/Orders HTTP/1.1

################################################################################
# Error Cases
################################################################################

### Get non-existent Order (404)
GET {{orderPath}}/Orders(00000000-0000-0000-0000-000000000000) HTTP/1.1

### Create Order without required fields (400)
POST {{orderPath}}/Orders HTTP/1.1
Content-Type: application/json

{
  "status": "open"
}

### Invalid status transition (400)
PATCH {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000) HTTP/1.1
Content-Type: application/json

{
  "status": "invalid_status"
}

### Delete non-draft order (409)
DELETE {{orderPath}}/Orders(550e8400-e29b-41d4-a716-446655440000) HTTP/1.1

################################################################################
# Performance Tests
################################################################################

### Get Orders with full expansion (performance test)
GET {{orderPath}}/Orders?$expand=items,history HTTP/1.1

### Get large result set
GET {{orderPath}}/Orders?$top=100 HTTP/1.1

### Complex filter query
GET {{orderPath}}/Orders?$filter=status eq 'confirmed' and totalAmount gt 50 and orderDate ge 2024-01-01&$orderby=totalAmount desc&$expand=items HTTP/1.1
